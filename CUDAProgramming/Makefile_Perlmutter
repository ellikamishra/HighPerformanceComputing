# Perlmutter build (A100, sm_80)
NVCC     ?= nvcc
ARCH     ?= -gencode arch=compute_80,code=sm_80

CXXFLAGS := -O3 -std=c++17 -Xcompiler -fopenmp -I$(CUDA_HOME)/include
LDFLAGS  := -L$(CUDA_HOME)/lib64 -lcublas -lcudart

SRC := main.cu dgemm_naive.cu dgemm_tiled.cu attention.cu
BIN := cuda_hw

all: $(BIN)

$(BIN): $(SRC) common.cuh
	$(NVCC) $(ARCH) $(CXXFLAGS) -o $@ $(SRC) $(LDFLAGS)

clean:
	rm -f $(BIN) *.o
